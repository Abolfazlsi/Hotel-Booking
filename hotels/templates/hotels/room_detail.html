{% extends "base.html" %}
{% load static %}

{% block main %}
    <div class="container-fluid" dir="rtl">
        <div class="room-detail-container">
            <div class="row g-0">
                <!-- Room Gallery Section -->
                <div class="col-lg-6">
                    <div class="room-gallery">
                        <img src="{% static "img/room/room-1.jpg" %}"
                             alt="اتاق هتل" class="main-image" id="mainImage" data-bs-toggle="modal"
                             data-bs-target="#imageModal">

                        <div class="thumbnail-gallery">
                            <img src="{% static "img/room/room-2.jpg" %}" alt="نمای اتاق 1" class="thumbnail active"
                                 onclick="changeMainImage(this)">
                            <img src="{% static "img/room/room-3.jpg" %}" alt="نمای اتاق 2" class="thumbnail"
                                 onclick="changeMainImage(this)">
                            <img src="{% static "img/room/room-4.jpg" %}" alt="نمای اتاق 3" class="thumbnail"
                                 onclick="changeMainImage(this)">
                            <img src="{% static "img/room/room-5.jpg" %}" alt="نمای اتاق 3"
                                 class="thumbnail" onclick="changeMainImage(this)">
                            <img src="{% static "img/room/room-6.jpg" %}" alt="نمای اتاق 3"
                                 class="thumbnail" onclick="changeMainImage(this)">


                        </div>
                    </div>
                </div>

                <!-- Room Information Section -->
                <div class="col-lg-6">
                    <div class="room-info">
                        <h1 class="room-title">اتاق استاندارد دو تخته</h1>

                        <p class="room-description">
                            اتاق نیل تنها دریای شهر شیراز در واقع شامل یک تخت‌خواب دو نفره است که به آن Double Room گفته
                            می‌شود. حالت یکی کن هم به صورت چهار تخت خواب یک نفره با جمع Quad است. این اتاق دارای امکانات
                            معمول متل سینما و استودیو می‌باشد.
                        </p>

                        <!-- Amenities Section -->
                        <div class="amenities-section">
                            <h3 class="section-title__room-detail">تجهیزات:</h3>
                            <div class="amenities-grid">
                                <div class="amenity-item">
                                    <span class="amenity-text">وای‌فای</span>
                                    <i class="fa fa-wifi amenity-icon"></i>
                                </div>
                                <div class="amenity-item">
                                    <span class="amenity-text">صبحانه</span>
                                    <i class="fa fa-coffee amenity-icon"></i>
                                </div>
                                <div class="amenity-item">
                                    <span class="amenity-text">اینترنت</span>
                                    <i class="fa fa-globe amenity-icon"></i>
                                </div>
                                <div class="amenity-item">
                                    <span class="amenity-text">تلویزیون</span>
                                    <i class="fa fa-tv amenity-icon"></i>
                                </div>
                                <div class="amenity-item">
                                    <span class="amenity-text">یخچال</span>
                                    <i class="fa fa-snowflake amenity-icon"></i>
                                </div>
                                <div class="amenity-item">
                                    <span class="amenity-text">کولر</span>
                                    <i class="fa fa-wind amenity-icon"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Features Section -->
                        <div class="features-section">
                            <h3 class="section-title__room-detail">خدمات:</h3>
                            <ul class="features-list">
                                <li>
                                    <span>استودیو خانواده</span>
                                    <div class="feature-bullet"></div>
                                </li>
                                <li>
                                    <span>بالکن دار</span>
                                    <div class="feature-bullet"></div>
                                </li>
                                <li>
                                    <span>سونا</span>
                                    <div class="feature-bullet"></div>
                                </li>
                                <li>
                                    <span>ویو شهر</span>
                                    <div class="feature-bullet"></div>
                                </li>
                            </ul>
                        </div>

                        <!-- Pricing Section -->
                        <div class="pricing-section">
                            <div class="price-label">قیمت هر شب</div>
                            <div class="price-amount">۳۰,۵۰۰,۰۰۰</div>
                            <div class="price-currency">ریال</div>
                        </div>

                        <button class="reserve-btn__room-detail" onclick="reserveRoom()">
                            رزرو اتاق
                        </button>
                    </div>
                </div>
            </div>

            <!-- Comments Section -->
            <div class="comments-section">
                <div class="container">
                    <h2 class="comments-title">نظرات</h2>
                    <p class="no-comments">هنوز بررسی‌ای ثبت نشده است.</p>

                    <h3 class="comment-form-title">پاسخ به نظر</h3>

                    <div class="comment-form">
                        <form id="commentForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">نام</label>
                                        <input type="text" class="form-control__room-detail" placeholder="نام" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">ایمیل</label>
                                        <input type="email" class="form-control__room-detail" placeholder="ایمیل"
                                               required>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">دیدگاه شما</label>
                                <textarea class="form-control__room-detail comment-textarea" placeholder="دیدگاه شما"
                                          required></textarea>
                            </div>

                            <div class="rating-section">
                                <label class="rating-label">امتیاز شما:</label>
                                <div class="star-rating" id="starRating">
                                    <i class="fa fa-star star" data-rating="1"></i>
                                    <i class="fa fa-star star" data-rating="2"></i>
                                    <i class="fa fa-star star" data-rating="3"></i>
                                    <i class="fa fa-star star" data-rating="4"></i>
                                    <i class="fa fa-star star" data-rating="5"></i>
                                </div>
                            </div>

                            <button type="submit" class="submit-comment-btn">
                                ارسال دیدگاه
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Back to Top Button -->
    <div class="back-to-top" id="backToTop">
        <i class="fa fa-chevron-up"></i>
    </div>

    <!-- Image Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">تصاویر اتاق</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/FireShot%20Capture%20002%20-%20%D9%BE%DB%8C%D8%B4%D9%86%D9%85%D8%A7%DB%8C%D8%B4%20%D9%82%D8%A7%D9%84%D8%A8%20%D8%B1%D8%B2%D8%B1%D9%88%20%D9%87%D8%AA%D9%84%D8%8C%20Hotel%20-%20%D8%B1%D8%A7%D8%B3%D8%AA%20%DA%86%DB%8C%D9%86%20-%20%5Brtlr.ir%5D.jpg-KAfkcm3aunpRjEDYU1jAvBiydEiLMy.jpeg"
                         alt="تصویر اتاق" class="modal-image" id="modalImage">
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content booking-modal-content">
                <div class="modal-header border-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="bookingForm" class="booking-form">
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="booking-label">تاریخ خروج:</label>
                                <input type="date" class="form-control__room-detail booking-input" id="checkoutDate"
                                       required>
                            </div>
                            <div class="col-md-6">
                                <label class="booking-label">تاریخ ورود:</label>
                                <input type="date" class="form-control__room-detail booking-input" id="checkinDate"
                                       required>
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="booking-label">نام کامل:</label>
                                <input type="text" class="form-control__room-detail booking-input"
                                       placeholder="نام کامل" required>
                            </div>
                            <div class="col-md-6">
                                <label class="booking-label">تعداد مهمان:</label>
                                <select class="form-control__room-detail booking-input" required>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                </select>
                            </div>
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label class="booking-label">کد ملی:</label>
                                <input type="text" class="form-control__room-detail booking-input" placeholder="کد ملی"
                                       maxlength="10" required>
                            </div>
                            <div class="col-md-6">
                                <label class="booking-label">شماره تلفن:</label>
                                <input type="tel" class="form-control__room-detail booking-input"
                                       placeholder="شماره تلفن" required>
                            </div>
                        </div>

                        <div class="text-start">
                            <button type="submit" class="btn payment-btn">
                                پرداخت
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('active');
        }

        // Change main image when thumbnail is clicked
        function changeMainImage(thumbnail) {
            const mainImage = document.getElementById('mainImage');
            const modalImage = document.getElementById('modalImage');

            // Remove active class from all thumbnails
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
            });

            // Add active class to clicked thumbnail
            thumbnail.classList.add('active');

            // Change main image source
            mainImage.src = thumbnail.src;
            modalImage.src = thumbnail.src;

            // Add animation effect
            mainImage.style.opacity = '0';
            setTimeout(() => {
                mainImage.style.opacity = '1';
            }, 150);
        }

        // Reserve room function - show booking modal
        function reserveRoom() {
            const bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
            bookingModal.show();
        }

        // Star rating functionality
        let selectedRating = 0;
        const stars = document.querySelectorAll('.star');

        stars.forEach(star => {
            star.addEventListener('click', function () {
                selectedRating = parseInt(this.getAttribute('data-rating'));
                updateStarDisplay();
            });

            star.addEventListener('mouseover', function () {
                const hoverRating = parseInt(this.getAttribute('data-rating'));
                highlightStars(hoverRating);
            });
        });

        document.getElementById('starRating').addEventListener('mouseleave', function () {
            updateStarDisplay();
        });

        function updateStarDisplay() {
            stars.forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function highlightStars(rating) {
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // Comment form submission
        document.getElementById('commentForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const name = this.querySelector('input[type="text"]').value;
            const email = this.querySelector('input[type="email"]').value;
            const comment = this.querySelector('textarea').value;

            // Validation
            if (!name || !email || !comment) {
                alert('لطفاً تمام فیلدها را پر کنید.');
                return;
            }

            if (selectedRating === 0) {
                alert('لطفاً امتیاز خود را انتخاب کنید.');
                return;
            }

            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('لطفاً یک آدرس ایمیل معتبر وارد کنید.');
                return;
            }

            // Show loading state
            const submitBtn = this.querySelector('.submit-comment-btn');
            const originalText = submitBtn.textContent;

            submitBtn.textContent = 'در حال ارسال...';
            submitBtn.disabled = true;

            // Simulate comment submission
            setTimeout(() => {
                alert(`نظر شما با موفقیت ثبت شد!\nنام: ${name}\nامتیاز: ${selectedRating} ستاره\nنظر: ${comment}`);

                // Reset form
                this.reset();
                selectedRating = 0;
                updateStarDisplay();

                submitBtn.textContent = originalText;
                submitBtn.disabled = false;

                // Update no comments message
                document.querySelector('.no-comments').textContent = 'نظر شما در انتظار تایید است.';
            }, 2000);
        });

        // Add smooth scroll animation for amenities
        const amenityItems = document.querySelectorAll('.amenity-item');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }, index * 100);
                }
            });
        });

        amenityItems.forEach(item => {
            item.style.opacity = '0';
            item.style.transform = 'translateY(20px)';
            item.style.transition = 'all 0.5s ease';
            observer.observe(item);
        });

        // Add ripple effect to buttons
        document.querySelectorAll('.reserve-btn, .submit-comment-btn').forEach(button => {
            button.addEventListener('click', function (e) {
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;

                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                ripple.classList.add('ripple');

                this.appendChild(ripple);

                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });


        // Booking form submission
        document.getElementById('bookingForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const checkinDate = document.getElementById('checkinDate').value;
            const checkoutDate = document.getElementById('checkoutDate').value;
            const fullName = this.querySelector('input[placeholder="نام کامل"]').value;
            const guestCount = this.querySelector('select').value;
            const nationalId = this.querySelector('input[placeholder="کد ملی"]').value;
            const phoneNumber = this.querySelector('input[type="tel"]').value;

            // Validation
            if (!checkinDate || !checkoutDate || !fullName || !nationalId || !phoneNumber) {
                alert('لطفاً تمام فیلدها را پر کنید.');
                return;
            }

            // Date validation
            const checkin = new Date(checkinDate);
            const checkout = new Date(checkoutDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (checkin < today) {
                alert('تاریخ ورود نمی‌تواند از امروز کمتر باشد.');
                return;
            }

            if (checkout <= checkin) {
                alert('تاریخ خروج باید بعد از تاریخ ورود باشد.');
                return;
            }

            // National ID validation (10 digits)
            if (!/^\d{10}$/.test(nationalId)) {
                alert('کد ملی باید ۱۰ رقم باشد.');
                return;
            }

            // Phone number validation
            if (!/^09\d{9}$/.test(phoneNumber)) {
                alert('شماره تلفن باید با ۰۹ شروع شده و ۱۱ رقم باشد.');
                return;
            }

            // Show loading state
            const submitBtn = this.querySelector('.payment-btn');
            const originalText = submitBtn.textContent;

            submitBtn.textContent = 'در حال پردازش...';
            submitBtn.disabled = true;

            // Calculate nights
            const nights = Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24));
            const totalPrice = nights * 30500000; // Price per night

            // Simulate booking process
            setTimeout(() => {
                alert(`رزرو شما با موفقیت ثبت شد!\n\nجزئیات رزرو:\nنام: ${fullName}\nتاریخ ورود: ${checkinDate}\nتاریخ خروج: ${checkoutDate}\nتعداد مهمان: ${guestCount}\nتعداد شب: ${nights}\nمبلغ کل: ${totalPrice.toLocaleString()} ریال\n\nبه زودی با شما تماس خواهیم گرفت.`);

                // Close modal and reset form
                const modal = bootstrap.Modal.getInstance(document.getElementById('bookingModal'));
                modal.hide();
                this.reset();

                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }, 2000);
        });

        // Set minimum date to today for check-in
        document.getElementById('checkinDate').min = new Date().toISOString().split('T')[0];

        // Update checkout minimum date when checkin changes
        document.getElementById('checkinDate').addEventListener('change', function () {
            const checkinDate = new Date(this.value);
            checkinDate.setDate(checkinDate.getDate() + 1);
            document.getElementById('checkoutDate').min = checkinDate.toISOString().split('T')[0];
        });

        // Back to top button functionality
        const backToTopBtn = document.getElementById('backToTop');

        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
        });

        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function (e) {
            const mobileMenu = document.getElementById('mobileMenu');
            const toggleBtn = document.querySelector('.mobile-menu-toggle');

            if (!mobileMenu.contains(e.target) && !toggleBtn.contains(e.target)) {
                mobileMenu.classList.remove('active');
            }
        });
    </script>

{% endblock %}